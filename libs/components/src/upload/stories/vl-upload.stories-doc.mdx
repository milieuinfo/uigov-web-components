import {ArgTypes, Canvas, Source} from '@storybook/blocks';
import * as VlUploadStories from './vl-upload.stories';
import addDuplicateWarning from './vl-upload.stories-util?raw';

# Upload

<VluxMetaData id="components-upload" />

Gebruik de `upload`-component om één of meerdere bestanden te selecteren of te slepen naar het upload-veld. De gebruiker
kan alternatief ook één of meerdere bestanden uploaden door op de link in het upload-veld te klikken en de bestanden
selecteren in het bestand-menu.


## Voorbeeld

```js
import { VlUploadComponent } from '@domg-wc/components';
```

```html
<vl-upload></vl-upload>
```

<Canvas of={VlUploadStories.UploadDefault} />


## Configuratie

<ArgTypes of={VlUploadStories.UploadDefault} />


## Info

Achterliggend gebruikt `vl-upload` de library `dropzone.js` ([https://www.dropzone.dev/](https://www.dropzone.dev/)).
Daarnaast gebruikt `vl-upload` het [vl-form-validation](/docs/elements-form--form-validation) element, die
achterliggend op zijn beurt gebruik maakt van [validate.js v0.12](http://validatejs.org/).

### Detect changes

Bij elke fileChange van `vl-upload` wordt het custom event `vl.upload.hook.fileChange` geactiveerd. Dit custom event
wordt zowel bij drop als bij verandering geactiveerd. Het evenement bevat een lijst van alle geüploade bestanden
in `e.detail`.

Je kunt een volledige lijst krijgen van alle geüploade bestanden per upload met `vl.upload.dropzoneInstances[i].files`
waarbij `i` de index is van je `vl-upload`-instantie.

Het event bubbelt omhoog: je kan de event listener toevoegen aan het document of op het element zelf.

Naast deze listeners kun je ook alle evenementen gebruiken die `dropzone.js` ondersteunt, raadpleeg de `dropzone.js`
documentatie voor meer info: [https://www.dropzone.dev/](https://www.dropzone.dev/).


## Varianten

### Binnen een form

Gelijkaardig aan de andere controls die overerven van de [`vl-form-validation`](/docs/elements-form--form-validation) kan je
`vl-form-validation-message` gebruiken om een foutboodschap te tonen.

In bepaalde instanties is het gewenst dat de `vl-upload` validatie gereset wordt na het verwijderen van bestanden. In
dat geval kan je `data-vl-reset-form-on-clear` toevoegen. Dit gaat de validatie resetten van de `vl-form` waartoe
deze `vl-upload` behoort.

<Canvas of={VlUploadStories.UploadInForm} />

### Duplicaat detectie

Het is mogelijk om duplicaten van eenzelfde bestand te vermijden met het `disallow-duplicates`-attribuut. Achterliggend
wordt er gecontroleerd op ofwel bestandsnaam en aantal bytes, of wordt een hex string vergeleken met eerder toegevoegde
bestanden. In dat geval worden de duplicaten verwijderd.

Wanneer een duplicaat wordt verwijderd kan je luisteren naar het `duplicateRemoved` event om de gebruiker te informeren
dat bestanden werden verwijderd wegens duplicaat detectie.

Onderstaand voorbeeld is ook geïntegreerd in de 2 stories die hierboven vermeld staan.

<details>
    <summary>code voorbeeld voor een waarschuwing te tonen bij duplicaat detectie </summary>
    <Source code={addDuplicateWarning} language="ts" dark={true} format={true} />
</details>


## Referenties

### Digitaal Vlaanderen

[Documentatie Digitaal Vlaanderen - Upload](https://overheid.vlaanderen.be/webuniversum/v3/documentation/forms/vl-ui-upload)

### Legacy Documentatie

[Legacy Storybook - Upload](https://webcomponenten.omgeving.vlaanderen.be/storybook/?path=/docs/legacy-vl-upload--uig-2120)

[Legacy Documentatie - Upload](https://webcomponenten.omgeving.vlaanderen.be/doc/VlUpload.html)

[Legacy Demo - Upload](https://webcomponenten.omgeving.vlaanderen.be/demo/vl-upload.html)
